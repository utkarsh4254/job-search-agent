name: ðŸ¤– Job Search Agent

on:
  schedule:
    - cron: "*/30 * * * *"
  workflow_dispatch:
    inputs:
      goal:
        description: "Custom search goal (optional)"
        required: false
        default: ""

permissions:
  contents: write

jobs:
  search-jobs:
    name: Search for new jobs
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: pip

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run job search agent
        env:
          GROQ_API_KEY:          ${{ secrets.GROQ_API_KEY }}
          GEMINI_API_KEY:        ${{ secrets.GEMINI_API_KEY }}
          ADZUNA_APP_ID:         ${{ secrets.ADZUNA_APP_ID }}
          ADZUNA_APP_KEY:        ${{ secrets.ADZUNA_APP_KEY }}
          GOOGLE_MAPS_API_KEY:   ${{ secrets.GOOGLE_MAPS_API_KEY }}
          NOTIFY_EMAIL_FROM:     ${{ secrets.NOTIFY_EMAIL_FROM }}
          NOTIFY_EMAIL_PASSWORD: ${{ secrets.NOTIFY_EMAIL_PASSWORD }}
          NOTIFY_EMAIL_TO:       ${{ secrets.NOTIFY_EMAIL_TO }}
          NOTIFY_EMAIL_PROVIDER: ${{ secrets.NOTIFY_EMAIL_PROVIDER }}
          SEARCH_KEYWORDS: "software engineer"
          SEARCH_LOCATION: ""
          SEARCH_INDUSTRY: "tech startup"
          MAX_JOB_AGE_DAYS: "1"
        run: python github_runner.py

      - name: Save jobs to repo
        run: |
          git config user.name  "Job Search Bot"
          git config user.email "bot@jobsearch.local"
          if git diff --quiet saved_jobs.json seen_jobs.json 2>/dev/null; then
            echo "No new jobs found â€” nothing to commit."
          else
            git add saved_jobs.json seen_jobs.json
            git commit -m "ðŸ¤– Job update: $(date +'%Y-%m-%d %H:%M') UTC"
            git push
            echo "âœ… New jobs committed to repo!"
          fi
